{% assign storybook_path = site.storybook_path %}
{% if include.is_mobile %}
  {% assign storybook_path = site.storybook_mobile_path %}
{% endif %}
{% assign storybook_iframe_path = storybook_path | append: '/iframe.html?id=' | append: include.story | append: '&viewMode=story' %}

<style>
  iframe {
    border: none;
    width: 100%;
    min-height: 300px; /* fallback height */
    opacity: 0;
    transition: opacity 0.3s ease;
    display: block;
  }
</style>

<div
  class="site-showcase"
  style="max-width: {{ include.width | default: '100%' }}"
>
  <iframe
    class="storybook-embed"
    id="{{ include.story }}"
    src="{{ storybook_iframe_path }}"
    title="Storybook: {{ include.story }}"
  ></iframe>
</div>

{% assign story_name_prefix = '' %}
{% if include.is_mobile %}
  {% assign story_name_prefix = 'va-mobile_' %}
{% endif %}
{% assign storybook_preview_path = site.storybook_path | append: '/?path=/story/' | append: story_name_prefix | append: include.story %}

[<img aria-hidden="true" role="img" src="{{ site.baseurl }}/images/storybook.svg" class="site-component-resources-links__icon" width="16px" alt="Storybook logo">View {{ include.link_text | default: 'this' }} in Storybook]({{ storybook_preview_path }})

<script>
  function resizeIframes() {
    const iframes = document.querySelectorAll('iframe.storybook-embed');
    
    iframes.forEach((iframe, index) => {
      try {
        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
        if (!iframeDoc) return;

        // Get the height of the iframe's body
        const newHeight = iframeDoc.body.scrollHeight;

        // Only update height if it's changed
        if (iframe.dataset.lastHeight != newHeight) {
          iframe.style.height = newHeight + 'px';
          iframe.dataset.lastHeight = newHeight;
        }
      } catch (err) {
        // Likely a cross-origin iframe, can't access it
        // Consider setting a default height or using postMessage version instead
        console.warn('Cannot access iframe content due to cross-origin restrictions:', err);
      }
    });
  }

  // Try resizing every 500ms (you can adjust this)
  setInterval(resizeIframes, 500);

  // Also try when the page first loads
  window.addEventListener('load', resizeIframes);
</script>